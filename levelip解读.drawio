<mxfile host="app.diagrams.net" modified="2021-01-24T08:03:02.880Z" agent="5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36" etag="uOa23ZshlOVDsFhhcJoS" version="14.2.7" type="github">
  <diagram id="JkMtZPwAcen48O5Z7KO6" name="第 1 页">
    <mxGraphModel dx="4890" dy="3346" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="h-AYutWAJ_S-bmYvBNu8-3" target="h-AYutWAJ_S-bmYvBNu8-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1140" y="1478.25" />
              <mxPoint x="1140" y="1478.25" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-2" value="inet_create" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="h-AYutWAJ_S-bmYvBNu8-1" vertex="1" connectable="0">
          <mxGeometry x="-0.1493" y="-1" relative="1" as="geometry">
            <mxPoint x="106.66999999999999" y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-3" value="生成socket【alloc_socket】&lt;br&gt;socket-state=&lt;span style=&quot;background-color: rgb(255 , 255 , 153)&quot;&gt;SS_UNCONNECTED&lt;/span&gt;&lt;br&gt;socket-&amp;gt;pid=msg-&amp;gt;pid&lt;br&gt;是调用者进程的PID&lt;br&gt;socket-&amp;gt;fd = 4097++&lt;br&gt;&lt;br&gt;调用inet_create&lt;br&gt;将socket加入&lt;font color=&quot;#ff8000&quot;&gt;sockets链表&lt;/font&gt;&lt;br&gt;sock_amount++&lt;br&gt;返回&lt;font color=&quot;#ff0000&quot;&gt;socket-&amp;gt;fd&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;align=left;" parent="1" vertex="1">
          <mxGeometry x="1030" y="1404.62" width="210" height="146.75" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="h-AYutWAJ_S-bmYvBNu8-6" target="h-AYutWAJ_S-bmYvBNu8-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-5" value="tcp_alloc_sock" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="h-AYutWAJ_S-bmYvBNu8-4" vertex="1" connectable="0">
          <mxGeometry x="-0.1667" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-6" value="根据传入的参数type&lt;br&gt;选择一项，作为skt：&lt;br&gt;&lt;div&gt;struct sock_type inet_ops[] = {&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;{&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;&amp;nbsp; .sock_ops = &amp;amp;sock_ops,&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;&amp;nbsp; .net_ops = &amp;amp;tcp_ops,&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;&amp;nbsp; .type = SOCK_STREAM,&lt;span&gt;  &lt;/span&gt;//TCP&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;&amp;nbsp; .protocol = IPPROTO_TCP,&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;},&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;{&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;&amp;nbsp; .sock_ops = &amp;amp;sock_ops,&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;&amp;nbsp; .net_ops = &amp;amp;udp_ops,&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;&amp;nbsp; .type = SOCK_DGRAM,&lt;span&gt;  &lt;/span&gt;//UDP&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;&amp;nbsp; .protocol = IPPROTO_UDP,&lt;/div&gt;&lt;div&gt;&lt;span&gt;   &lt;/span&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;socket-&amp;gt;ops = skt-&amp;gt;sock_ops;/&lt;font color=&quot;#ff0000&quot;&gt;/inet_stream_ops&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;生成sock（简写为sk）&lt;/div&gt;&lt;div&gt;&lt;div&gt;sk-&amp;gt;ops = skt-&amp;gt;net_ops&lt;/div&gt;&lt;div&gt;即 sk-&amp;gt;ops = tcp_ops 或是 udp_ops&lt;/div&gt;&lt;/div&gt;&lt;div&gt;生成sock调用的是&lt;font color=&quot;#ff0000&quot;&gt;&amp;nbsp;&lt;span&gt;tcp_ops-&amp;gt;alloc_sock&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;返回的也是 tcp_sock 类型强转成的 sock&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;sock_init_data：&lt;br&gt;&lt;/div&gt;&lt;div&gt;socket和sock互相关联&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="1350" y="1283" width="270" height="390" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="h-AYutWAJ_S-bmYvBNu8-9" target="h-AYutWAJ_S-bmYvBNu8-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-8" value="IPC_SOCKET" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="h-AYutWAJ_S-bmYvBNu8-7" vertex="1" connectable="0">
          <mxGeometry x="0.2507" y="-4" relative="1" as="geometry">
            <mxPoint x="-15" y="-4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nQ9esfCF_CsTz2VPVnLO-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="h-AYutWAJ_S-bmYvBNu8-9" target="nQ9esfCF_CsTz2VPVnLO-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="360" y="1478" />
              <mxPoint x="360" y="2496" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="nQ9esfCF_CsTz2VPVnLO-3" value="IPC_CONNECT" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="nQ9esfCF_CsTz2VPVnLO-2" vertex="1" connectable="0">
          <mxGeometry x="-0.2011" y="-4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-9" value="start_ipc_listener线程：&lt;br&gt;生成一个UNIX域的socket&lt;br&gt;accept之后，产生一个新的datasocket&lt;br&gt;创建ipc_thread结构&lt;br&gt;th-&amp;gt;sock = datasocket&lt;br&gt;将ipc_thread加入到sockets链表【不是connetions链表】名字无所谓，static的&lt;br&gt;socket_count++&lt;br&gt;&lt;br&gt;启动新线程&lt;br&gt;读取datasocket获得消息&lt;br&gt;调用demux_ipc_socket_call分发消息&lt;br&gt;消息类型有：&lt;br&gt;&lt;div&gt;IPC_SOCKET&lt;/div&gt;&lt;div&gt;IPC_CONNECT&lt;/div&gt;&lt;div&gt;IPC_WRITE&lt;/div&gt;&lt;div&gt;IPC_READ&lt;/div&gt;&lt;div&gt;IPC_CLOSE&lt;/div&gt;&lt;div&gt;IPC_POLL&lt;/div&gt;&lt;div&gt;IPC_FCNTL&lt;/div&gt;&lt;div&gt;getsockopt/getpeername/getsockname&lt;/div&gt;&lt;div&gt;下边的都没有：&lt;/div&gt;&lt;div&gt;bind/accept/listen/&lt;span&gt;SENDTO/&lt;/span&gt;&lt;span&gt;RECVFROM&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="100" y="1314.63" width="230" height="326.75" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="h-AYutWAJ_S-bmYvBNu8-14" target="h-AYutWAJ_S-bmYvBNu8-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-11" value="_socket" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="h-AYutWAJ_S-bmYvBNu8-10" vertex="1" connectable="0">
          <mxGeometry x="0.2545" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="h-AYutWAJ_S-bmYvBNu8-14" target="h-AYutWAJ_S-bmYvBNu8-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-13" value="ipc_write_rc" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="h-AYutWAJ_S-bmYvBNu8-12" vertex="1" connectable="0">
          <mxGeometry x="-0.1511" y="-4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-14" value="struct &lt;font color=&quot;#ff8000&quot;&gt;ipc_socket &lt;/font&gt;*ipc_socket = (struct ipc_socket *)msg-&amp;gt;data;&lt;br&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;pid_t pid = msg-&amp;gt;pid;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;//返回新建socket的fd&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;rc = _socket(pid, ipc_socket-&amp;gt;domain, ipc_socket-&amp;gt;type, ipc_socket-&amp;gt;protocol);&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;return ipc_write_rc(sockfd, pid, IPC_SOCKET, &lt;font color=&quot;#ff0000&quot;&gt;rc&lt;/font&gt;);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="480" y="1431.75" width="430" height="92.5" as="geometry" />
        </mxCell>
        <mxCell id="nQ9esfCF_CsTz2VPVnLO-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="h-AYutWAJ_S-bmYvBNu8-15" target="nQ9esfCF_CsTz2VPVnLO-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1500" y="1763.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-15" value="int resplen = sizeof(struct ipc_msg) + sizeof(struct ipc_err);&lt;br&gt;&lt;div&gt;&lt;span&gt;err.rc =&lt;/span&gt;&lt;font color=&quot;#ff0000&quot;&gt; rc&lt;/font&gt;&lt;span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;memcpy(response-&amp;gt;data, &amp;amp;err, sizeof(struct ipc_err));&lt;/div&gt;write(sockfd, (char *)response, resplen)通过UNIX域的socket回复" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="970" y="1934.0900000000001" width="350" height="81.5" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-16" value="&lt;div&gt;tsk-&amp;gt;sk.state = &lt;span style=&quot;background-color: rgb(255 , 255 , 153)&quot;&gt;TCP_CLOSE&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;tsk-&amp;gt;sackok = 1;&lt;/div&gt;&lt;div&gt;&lt;span&gt;tsk-&amp;gt;rmss = 1460;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;// send maximum segment size -拥塞控制相关&lt;/div&gt;&lt;div&gt;// Default to 536 as per spec&lt;/div&gt;&lt;div&gt;tsk-&amp;gt;smss = 536;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;skb_queue_init(&amp;amp;tsk-&amp;gt;ofo_queue);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="1740" y="1409.25" width="290" height="137.5" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-17" value="IPC层" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;" parent="1" vertex="1">
          <mxGeometry x="200" y="1270" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-18" value="socket层" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;" parent="1" vertex="1">
          <mxGeometry x="1170" y="1270" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-19" value="sock层&lt;br&gt;tcp_sock层" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;" parent="1" vertex="1">
          <mxGeometry x="1850" y="1260" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="h-AYutWAJ_S-bmYvBNu8-22" value="一、协议栈中三个网卡的IP地址：&lt;br&gt;tap设备&amp;nbsp; &amp;nbsp;&lt;font color=&quot;#ff0000&quot;&gt;10.0.0.5&lt;/font&gt;&lt;br&gt;netdev&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff0000&quot;&gt;10.0.0.4&lt;/font&gt;&lt;br&gt;loop&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 127.0.0.1&lt;br&gt;&lt;br&gt;&lt;br&gt;二、程序总体规划：&lt;br&gt;&lt;br&gt;curl应用程序调用的系统调用接口&lt;br&gt;都被liblevelip.so接管了&lt;br&gt;而这些系统调用的实现，最后读写的是Unix域的那个socket。负责处理的是 start_ipc_listener 线程&lt;br&gt;例如curl调用了liblevelip.so里的read系统调用，&lt;br&gt;它做的事：读写了Unix域的socket&lt;br&gt;最终需要了解的是 start_ipc_listener 线程中IPC_WRITE/IPC_READ的实现。&lt;br&gt;&lt;br&gt;&lt;br&gt;网卡收到的数据，给到tap0设备，是另外一个线程 netdev_rx_loop 去处理，它 read/write tap 设备&lt;br&gt;&lt;br&gt;三、测试ARP模块时，&lt;br&gt;使用命&lt;font&gt;令&amp;nbsp;&lt;span style=&quot;font-size: 12px ; background-color: rgb(238 , 238 , 238) ; color: rgb(17 , 17 , 17)&quot;&gt;arping &lt;/span&gt;&lt;span class=&quot;nt&quot; style=&quot;font-size: 12px ; background-color: rgb(238 , 238 , 238) ; color: navy&quot;&gt;-i&lt;/span&gt;&lt;span style=&quot;color: rgb(17 , 17 , 17) ; font-size: 12px ; background-color: rgb(238 , 238 , 238)&quot;&gt;&amp;nbsp;tap0 10.0.0.4&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;color: rgb(17 , 17 , 17) ; font-size: 12px ; background-color: rgb(255 , 255 , 255)&quot;&gt;将arp数据发给tap网卡，netdev_rx_loop线程read tap设备后，获得arp请求的数据。&lt;br&gt;在本协议栈中处理后，再通过write tap设备，将回应数据发出。&lt;br&gt;&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#111111&quot;&gt;四、测试ICMP模块时，&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#111111&quot;&gt;使用命令 ping 10.0.0.4&lt;br&gt;&lt;/font&gt;linux系统会将数据从同属10.0.0.x网段的tap网卡将数据发出。&lt;br&gt;之后处理同ARP过程。&lt;br&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="-680" y="-1040" width="550" height="445.75" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="nQ9esfCF_CsTz2VPVnLO-1" target="yaBAwWdUjn6GlstP9hA2-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-3" value="_connect" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-2" vertex="1" connectable="0">
          <mxGeometry x="0.2767" y="3" relative="1" as="geometry">
            <mxPoint x="-17.25" y="2.94" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dzpFjZSb-bzoJs8NH7mf-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;dashed=1;" parent="1" source="nQ9esfCF_CsTz2VPVnLO-1" target="dzpFjZSb-bzoJs8NH7mf-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="nQ9esfCF_CsTz2VPVnLO-1" value="&lt;div&gt;struct &lt;font color=&quot;#ff8000&quot;&gt;ipc_connect&lt;/font&gt; *payload = (struct ipc_connect *)msg-&amp;gt;data;&lt;/div&gt;&lt;div&gt;pid_t pid = msg-&amp;gt;pid;调用者进程的PID&lt;/div&gt;&lt;div&gt;payload-&amp;gt;sockfd是调用者调用_socket之后，生成的fd是4097++那个&lt;/div&gt;&lt;div&gt;rc = _connect(pid, &lt;font color=&quot;#ff0000&quot;&gt;payload-&amp;gt;sockfd&lt;/font&gt;, &amp;amp;payload-&amp;gt;addr, payload-&amp;gt;addrlen);&lt;/div&gt;&lt;div&gt;return ipc_write_rc(sockfd, pid, IPC_CONNECT, rc);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="474" y="2450" width="430" height="92.5" as="geometry" />
        </mxCell>
        <mxCell id="nQ9esfCF_CsTz2VPVnLO-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="nQ9esfCF_CsTz2VPVnLO-5" target="nQ9esfCF_CsTz2VPVnLO-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="nQ9esfCF_CsTz2VPVnLO-9" value="&lt;span style=&quot;color: rgb(0 , 0 , 0) ; font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;transmit_lvlip&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=20;fontColor=#FF00FF;" parent="nQ9esfCF_CsTz2VPVnLO-7" vertex="1" connectable="0">
          <mxGeometry x="0.2879" y="2" relative="1" as="geometry">
            <mxPoint x="-20.83" y="-2.84" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nQ9esfCF_CsTz2VPVnLO-5" value="socket函数：&lt;br&gt;&amp;nbsp; &amp;nbsp; 关联到UNIX域的文件：&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int lvlfd = init_socket(&quot;/tmp/lvlip.socket&quot;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct lvlip_sock *sock = lvlip_alloc();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; sock-&amp;gt;lvlfd = lvlfd;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; list_add_tail(&amp;amp;sock-&amp;gt;list, &amp;amp;lvlip_socks);//加入到lvlip_socks链表&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; lvlip_socks_count++;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int pid = getpid();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int msglen = sizeof(struct ipc_msg) + sizeof(struct ipc_socket);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct ipc_msg *msg = alloca(msglen);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; msg-&amp;gt;type = &lt;font color=&quot;#009900&quot;&gt;IPC_SOCKET;//这个类型出现了！&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; msg-&amp;gt;pid = pid;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct ipc_socket usersock = {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .domain = domain,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .type = type,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .protocol = protocol&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; };&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memcpy(msg-&amp;gt;data, &amp;amp;usersock, sizeof(struct ipc_socket));&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; //返回的是 lvl-ip 进程给分配的sockfd&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int sockfd = transmit_lvlip(sock-&amp;gt;lvlfd, msg, msglen);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return sock-&amp;gt;fd = sockfd;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;strokeColor=#FF00FF;" parent="1" vertex="1">
          <mxGeometry x="1690" y="1767.3400000000001" width="350" height="415" as="geometry" />
        </mxCell>
        <mxCell id="nQ9esfCF_CsTz2VPVnLO-6" value="&lt;div&gt;_write(lvlfd, (char *)msg, msglen)&lt;/div&gt;&lt;div&gt;&lt;span&gt;_read(lvlfd, buf, RCBUF_LEN)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;// 发送的格式、回应的格式，都是自己定义的，哈哈哈！&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;// ipc_msg + ipc_err&lt;/div&gt;&lt;div&gt;struct ipc_msg *response = (struct ipc_msg *) buf;&lt;/div&gt;&lt;div&gt;&lt;span&gt;struct ipc_err *err = (struct ipc_err *) response-&amp;gt;data;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;font color=&quot;#ff00ff&quot;&gt;返回的是一个文件描述符！&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;return err-&amp;gt;rc;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;strokeColor=#FF00FF;" parent="1" vertex="1">
          <mxGeometry x="2150" y="1887.3400000000001" width="350" height="175" as="geometry" />
        </mxCell>
        <mxCell id="nQ9esfCF_CsTz2VPVnLO-8" value="&lt;span style=&quot;text-align: left; font-size: 20px;&quot;&gt;liblevelip.so&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF00FF;" parent="1" vertex="1">
          <mxGeometry x="2067" y="1770" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-10" target="yaBAwWdUjn6GlstP9hA2-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-6" value="tcp_v4_connect" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-5" vertex="1" connectable="0">
          <mxGeometry x="-0.106" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-1" target="yaBAwWdUjn6GlstP9hA2-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-12" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;inet_stream_connect&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-11" vertex="1" connectable="0">
          <mxGeometry x="-0.2237" relative="1" as="geometry">
            <mxPoint x="11.67" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-1" value="get_socket():根据pid和fd查找到socket&lt;br&gt;&lt;br&gt;sock-&amp;gt;ops-&amp;gt;connect == &lt;br&gt;inet_stream_ops-&amp;gt;connect == &lt;br&gt;inet_stream_connect&lt;br&gt;&lt;br&gt;return inet_stream_connect();" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;align=left;" parent="1" vertex="1">
          <mxGeometry x="1030" y="2431.24" width="210" height="130" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-4" target="yaBAwWdUjn6GlstP9hA2-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-9" value="tcp_connect" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-8" vertex="1" connectable="0">
          <mxGeometry x="-0.2337" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-4" value="&lt;div&gt;uint16_t dport = ((struct sockaddr_in *)addr)-&amp;gt;sin_port;&lt;/div&gt;&lt;div&gt;uint32_t daddr = ((struct sockaddr_in *)addr)-&amp;gt;sin_addr.s_addr;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;sk-&amp;gt;dport = ntohs(dport);&lt;/div&gt;&lt;div&gt;sk-&amp;gt;sport = generate_port();随机一个口&lt;/div&gt;&lt;div&gt;sk-&amp;gt;daddr = ntohl(daddr);&lt;/div&gt;&lt;div&gt;sk-&amp;gt;saddr = parse_ipv4_string(&quot;10.0.0.4&quot;); tap设备的IP地址&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;return tcp_connect(sk);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="2740" y="2420.54" width="360" height="151.41" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-7" target="yaBAwWdUjn6GlstP9hA2-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-16" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;tcp_send_syn&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-15" vertex="1" connectable="0">
          <mxGeometry x="-0.3082" y="-2" relative="1" as="geometry">
            <mxPoint x="14.999999999999998" y="-1.99" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-7" value="&lt;div&gt;//把 struct sock 转换回去为 struct tcp_sock&lt;/div&gt;&lt;div&gt;struct tcp_sock *tsk = tcp_sk(sk);&lt;/div&gt;&lt;div&gt;struct tcb *tcb = &amp;amp;tsk-&amp;gt;tcb;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;tsk-&amp;gt;tcp_header_len = sizeof(struct tcphdr);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;tcb-&amp;gt;iss = generate_iss();&lt;/div&gt;&lt;div&gt;tcb-&amp;gt;snd_wnd = 0;&lt;/div&gt;&lt;div&gt;tcb-&amp;gt;snd_wl1 = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;tcb-&amp;gt;snd_una = tcb-&amp;gt;iss;&lt;/div&gt;&lt;div&gt;tcb-&amp;gt;snd_up = tcb-&amp;gt;iss;&lt;/div&gt;&lt;div&gt;tcb-&amp;gt;snd_nxt = tcb-&amp;gt;iss;&lt;/div&gt;&lt;div&gt;tcb-&amp;gt;rcv_nxt = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//接收窗口的大小&lt;/div&gt;&lt;div&gt;tcp_select_initial_window(&amp;amp;tsk-&amp;gt;tcb.rcv_wnd);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;// tcp_send_syn可能由于暂时找不到以太网地址的原因发送失败&lt;/div&gt;&lt;div&gt;// 但是存在定时器,隔一段时间再次尝试发送.&lt;/div&gt;&lt;div&gt;rc = tcp_send_syn(sk);&lt;/div&gt;&lt;div&gt;tcb-&amp;gt;snd_nxt++;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;return rc;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="3223" y="2310.1099999999997" width="349" height="372.29" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-10" value="通过socket找到sock&lt;br&gt;&lt;br&gt;socket-&amp;gt;state ==&amp;nbsp;&lt;span style=&quot;background-color: rgb(255 , 255 , 153)&quot;&gt;SS_UNCONNECTED&lt;/span&gt;&lt;br&gt;sock-&amp;gt;state ==&amp;nbsp;&lt;span style=&quot;background-color: rgb(255 , 255 , 153)&quot;&gt;TCP_CLOSE&lt;/span&gt;&lt;br&gt;&lt;br&gt;sk-&amp;gt;ops-&amp;gt;connect == &lt;br&gt;tcp_ops-&amp;gt;connect == &lt;font color=&quot;#ff0000&quot;&gt;tcp_v4_connect&lt;/font&gt;&lt;br&gt;&lt;br&gt;上边函数返回后，调整状态：&lt;br&gt;sock-&amp;gt;state = &lt;span style=&quot;background-color: rgb(255 , 255 , 102)&quot;&gt;SS_CONNECTING;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;br&gt;&lt;font color=&quot;#0000ff&quot;&gt;条件变量阻塞，被其他线程唤醒后继续执行&lt;br&gt;如果&lt;br&gt;sock-&amp;gt;state == SS_CONNECTING &amp;amp;&amp;amp; &lt;br&gt;sk-&amp;gt;err == -EINPROGRESS&lt;br&gt;则继续阻塞在这里。&lt;/font&gt;&lt;br&gt;&lt;br&gt;sk-&amp;gt;err为0时，调整状态：&lt;br&gt;&lt;/span&gt;sock-&amp;gt;state = &lt;span style=&quot;background-color: rgb(255 , 255 , 102)&quot;&gt;SS_CONNECTED;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(255 , 255 , 255)&quot;&gt;返回sk-&amp;gt;err&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="1390" y="2336.33" width="250" height="320.38" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-14" target="yaBAwWdUjn6GlstP9hA2-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4052" y="2496" />
              <mxPoint x="4052" y="2105" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-19" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;tcp_syn_options&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-18" vertex="1" connectable="0">
          <mxGeometry x="0.1131" y="3" relative="1" as="geometry">
            <mxPoint x="73" y="-109.2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-14" target="yaBAwWdUjn6GlstP9hA2-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4052" y="2496" />
              <mxPoint x="4052" y="2371" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-22" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;tcp_alloc_skb&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-21" vertex="1" connectable="0">
          <mxGeometry x="0.5684" y="-3" relative="1" as="geometry">
            <mxPoint x="-5.899999999999999" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-14" target="yaBAwWdUjn6GlstP9hA2-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-31" value="tcp_hdr" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-30" vertex="1" connectable="0">
          <mxGeometry x="0.2517" y="-3" relative="1" as="geometry">
            <mxPoint x="-6.5" y="-3.07" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yaBAwWdUjn6GlstP9hA2-14" target="yaBAwWdUjn6GlstP9hA2-32" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4052" y="2496" />
              <mxPoint x="4052" y="2692" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-34" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;tcp_write_options&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-33" vertex="1" connectable="0">
          <mxGeometry x="0.7886" y="-4" relative="1" as="geometry">
            <mxPoint x="-31.67" y="-4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-14" target="yaBAwWdUjn6GlstP9hA2-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4052" y="2496" />
              <mxPoint x="4052" y="3040" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-37" value="tcp_queue_transmit_skb" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-36" vertex="1" connectable="0">
          <mxGeometry x="0.7182" y="-2" relative="1" as="geometry">
            <mxPoint x="10.67" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-14" value="&lt;div&gt;struct sk_buff *skb;&lt;/div&gt;&lt;div&gt;struct tcphdr *th;&lt;/div&gt;&lt;div&gt;struct tcp_options opts = { 0 };&lt;/div&gt;&lt;div&gt;int tcp_options_len = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;tcp_options_len = tcp_syn_options(sk, &amp;amp;opts);&lt;span&gt; &lt;/span&gt;//tcp选项的长度&lt;/div&gt;&lt;div&gt;skb = tcp_alloc_skb(tcp_options_len, 0);&lt;span&gt;  &lt;/span&gt;//需要发送tcp选项&lt;/div&gt;&lt;div&gt;th = tcp_hdr(skb);&lt;span&gt;        &lt;/span&gt;//指向tcp头部&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;tcp_write_options(th, &amp;amp;opts, tcp_options_len);&lt;/div&gt;&lt;div&gt;sk-&amp;gt;state = &lt;span style=&quot;background-color: rgb(255 , 255 , 102)&quot;&gt;TCP_SYN_SENT&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;th-&amp;gt;syn = 1;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;return tcp_queue_transmit_skb(sk, skb);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="3682" y="2368.44" width="340" height="255.62" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-17" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; struct tcp_sock *tsk = tcp_sk(sk);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; opts-&amp;gt;mss = tsk-&amp;gt;rmss;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; optlen += TCP_OPTLEN_MSS;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (tsk-&amp;gt;sackok) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; opts-&amp;gt;sack = 1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; optlen += TCP_OPT_NOOP * 2;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; optlen += TCP_OPTLEN_SACK;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; opts-&amp;gt;sack = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return optlen;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="4192" y="2000" width="300" height="210" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-20" target="yaBAwWdUjn6GlstP9hA2-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-25" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;alloc_skb&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-24" vertex="1" connectable="0">
          <mxGeometry x="-0.3" relative="1" as="geometry">
            <mxPoint x="8" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yaBAwWdUjn6GlstP9hA2-20" target="yaBAwWdUjn6GlstP9hA2-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-28" value="skb_reserve" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-27" vertex="1" connectable="0">
          <mxGeometry x="-0.1435" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-20" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; int reserved = ETH_HDR_LEN + IP_HDR_LEN + TCP_HDR_LEN + optlen + size;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct sk_buff *skb = alloc_skb(reserved);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb_reserve(skb, reserved);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;protocol = IP_TCP;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;dlen = size;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;seq = 0;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="4192" y="2310.1099999999997" width="470" height="122" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-23" value="&lt;div&gt;struct sk_buff *skb = malloc(sizeof(struct sk_buff));&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;memset(skb, 0, sizeof(struct sk_buff));&lt;/div&gt;&lt;div&gt;skb-&amp;gt;data = malloc(size);&lt;/div&gt;&lt;div&gt;memset(skb-&amp;gt;data, 0, size);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;skb-&amp;gt;refcnt = 0;&lt;/div&gt;&lt;div&gt;skb-&amp;gt;head = skb-&amp;gt;data;&lt;/div&gt;&lt;div&gt;skb-&amp;gt;end = skb-&amp;gt;data + size;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;list_init(&amp;amp;skb-&amp;gt;list);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;return skb;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="4772" y="2120" width="290" height="208.89" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-26" value="&lt;div&gt;//一下保留很多段&lt;/div&gt;&lt;div&gt;void *skb_reserve(struct sk_buff *skb, unsigned int len)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;data += len;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return skb-&amp;gt;data;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//要修改哪一段的内容时，把哪一段push出来。&lt;/div&gt;&lt;div&gt;uint8_t *skb_push(struct sk_buff *skb, unsigned int len)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;data -= len;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;len += len;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return skb-&amp;gt;data;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="4772" y="2368.44" width="308" height="238" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-29" value="head向后，跳过ETH头，跳过IP头&lt;br&gt;(struct tcphdr *)(skb-&amp;gt;head + ETH_HDR_LEN + IP_HDR_LEN);" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="4192" y="2461.88" width="350" height="68.75" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-32" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; struct tcp_opt_mss *opt_mss = (struct tcp_opt_mss *) th-&amp;gt;data;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; uint32_t i = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; opt_mss-&amp;gt;kind = TCP_OPT_MSS;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; opt_mss-&amp;gt;len = TCP_OPTLEN_MSS;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; opt_mss-&amp;gt;mss = htons(opts-&amp;gt;mss);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; i += sizeof(struct tcp_opt_mss);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (opts-&amp;gt;sack) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; th-&amp;gt;data[i++] = TCP_OPT_NOOP;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; th-&amp;gt;data[i++] = TCP_OPT_NOOP;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; th-&amp;gt;data[i++] = TCP_OPT_SACK_OK;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; th-&amp;gt;data[i++] = TCP_OPTLEN_SACK;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; th-&amp;gt;hl = TCP_DOFFSET + (optlen / 4);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="4192" y="2564" width="360" height="256" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yaBAwWdUjn6GlstP9hA2-35" target="yaBAwWdUjn6GlstP9hA2-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-40" value="tcp_rearm_rto_timer" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-39" vertex="1" connectable="0">
          <mxGeometry x="0.244" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-35" target="yaBAwWdUjn6GlstP9hA2-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-54" value="tcp_transmit_skb" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-51" vertex="1" connectable="0">
          <mxGeometry x="-0.0557" y="6" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-35" value="&lt;div&gt;&lt;div&gt;//tcp_queue_transmit_skb 将要发送的内容加入write_queue,&lt;/div&gt;&lt;div&gt;//没有接收到ack的话,会一直重传该数据包&lt;/div&gt;&lt;div&gt;//而tcp_transmit_skb函数不会如此.&amp;nbsp;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct tcp_sock *tsk = tcp_sk(sk);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct tcb *tcb = &amp;amp;tsk-&amp;gt;tcb;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct tcphdr * th = tcp_hdr(skb);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (skb_queue_empty(&amp;amp;sk-&amp;gt;write_queue)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;tcp_rearm_rto_timer&lt;/font&gt;(tsk);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (tsk-&amp;gt;inflight == 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* Store sequence information into the socket buffer */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; rc = &lt;font color=&quot;#ff6666&quot;&gt;tcp_transmit_skb&lt;/font&gt;(sk, skb, tcb-&amp;gt;snd_nxt);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tsk-&amp;gt;inflight++;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; skb-&amp;gt;seq = tcb-&amp;gt;snd_nxt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tcb-&amp;gt;snd_nxt += skb-&amp;gt;dlen;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; skb-&amp;gt;end_seq = tcb-&amp;gt;snd_nxt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (th-&amp;gt;fin) tcb-&amp;gt;snd_nxt++;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb_queue_tail(&amp;amp;sk-&amp;gt;write_queue, skb);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return rc;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="4192" y="2850" width="340" height="380" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-38" target="yaBAwWdUjn6GlstP9hA2-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-43" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;tcp_release_rto_timer&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-42" vertex="1" connectable="0">
          <mxGeometry x="-0.2231" y="1" relative="1" as="geometry">
            <mxPoint x="7.5" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-38" target="yaBAwWdUjn6GlstP9hA2-44" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5312" y="2880" />
              <mxPoint x="5312" y="2990" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-46" value="定时任务 tcp_connect_rto" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-45" vertex="1" connectable="0">
          <mxGeometry x="0.5123" y="-1" relative="1" as="geometry">
            <mxPoint x="2.5" y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-38" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; struct sock *sk = &amp;amp;tsk-&amp;gt;sk;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; tcp_release_rto_timer(tsk);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; 加定时器任务&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (sk-&amp;gt;state == &lt;span style=&quot;background-color: rgb(255 , 255 , 102)&quot;&gt;TCP_SYN_SENT&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tsk-&amp;gt;retransmit = timer_add(TCP_SYN_BACKOFF &amp;lt;&amp;lt; tsk-&amp;gt;backoff, &amp;amp;tcp_connect_rto, tsk);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tsk-&amp;gt;retransmit = timer_add(tsk-&amp;gt;rto, &amp;amp;tcp_retransmission_timeout, tsk);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="4711" y="2810" width="521" height="140" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-41" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; if (tsk) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; timer_release(tsk-&amp;gt;retransmit);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tsk-&amp;gt;retransmit = NULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="5392" y="2690" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-44" target="yaBAwWdUjn6GlstP9hA2-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-49" value="tcp_done" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-48" vertex="1" connectable="0">
          <mxGeometry x="0.6842" y="-2" relative="1" as="geometry">
            <mxPoint x="-34.17" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yaBAwWdUjn6GlstP9hA2-44" target="yaBAwWdUjn6GlstP9hA2-50" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5742" y="3230" />
              <mxPoint x="4972" y="3230" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-53" value="tcp_transmit_skb" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-52" vertex="1" connectable="0">
          <mxGeometry x="-0.1269" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-44" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; struct tcp_sock *tsk = (struct tcp_sock *) arg;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct tcb *tcb = &amp;amp;tsk-&amp;gt;tcb;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct sock *sk = &amp;amp;tsk-&amp;gt;sk;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; socket_wr_acquire(sk-&amp;gt;sock);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; tcp_release_rto_timer(tsk);取消掉定时任务&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (sk-&amp;gt;state == TCP_SYN_SENT) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (tsk-&amp;gt;backoff &amp;gt; TCP_CONN_RETRIES) {//超过3次&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tsk-&amp;gt;sk.err = -ETIMEDOUT;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; sk-&amp;gt;poll_events |= (POLLOUT | POLLERR | POLLHUP);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tcp_done(sk);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; struct sk_buff *skb = write_queue_head(sk);//sk-&amp;gt;write_queue的第一个节点&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (skb) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; skb_reset_header(skb);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;tcp_transmit_skb&lt;/font&gt;(sk, skb, tcb-&amp;gt;snd_una);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tsk-&amp;gt;backoff++; 增加重试计数&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tcp_rearm_rto_timer(tsk); 重启定时任务&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; print_err(&quot;TCP connect RTO triggered even when not in SYNSENT\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; socket_release(sk-&amp;gt;sock);销毁struct sock&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="5512" y="2780" width="460" height="420" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-47" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; tcp_set_state(sk, TCP_CLOSING);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; tcp_free(sk);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return socket_delete(sk-&amp;gt;sock);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="6062" y="2955" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-56" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fillColor=#6a00ff;strokeColor=#3700CC;" parent="1" source="yaBAwWdUjn6GlstP9hA2-50" target="yaBAwWdUjn6GlstP9hA2-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-58" value="ip_output" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-56" vertex="1" connectable="0">
          <mxGeometry x="0.1339" y="-5" relative="1" as="geometry">
            <mxPoint x="-77.65" y="-5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-50" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; struct tcp_sock *tsk = tcp_sk(sk);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct tcb *tcb = &amp;amp;tsk-&amp;gt;tcb;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct tcphdr *thdr = tcp_hdr(skb);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /* No options were previously set */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (thdr-&amp;gt;hl == 0) thdr-&amp;gt;hl = TCP_DOFFSET;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb_push(skb, thdr-&amp;gt;hl * 4);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;sport = sk-&amp;gt;sport;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;dport = sk-&amp;gt;dport;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;seq = seq;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;ack_seq = tcb-&amp;gt;rcv_nxt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;rsvd = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;win = tcb-&amp;gt;rcv_wnd;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;csum = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;urp = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (thdr-&amp;gt;hl &amp;gt; 5) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tcp_write_options(tsk, thdr);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; tcp_out_dbg(thdr, sk, skb);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;sport = htons(thdr-&amp;gt;sport);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;dport = htons(thdr-&amp;gt;dport);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;seq = htonl(thdr-&amp;gt;seq);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;ack_seq = htonl(thdr-&amp;gt;ack_seq);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;win = htons(thdr-&amp;gt;win);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;csum = htons(thdr-&amp;gt;csum);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;urp = htons(thdr-&amp;gt;urp);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; thdr-&amp;gt;csum = tcp_v4_checksum(skb, htonl(sk-&amp;gt;saddr), htonl(sk-&amp;gt;daddr));&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return ip_output(sk, skb);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="4711" y="3260" width="521" height="510" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yaBAwWdUjn6GlstP9hA2-55" target="yaBAwWdUjn6GlstP9hA2-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-62" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;dst_neigh_output&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-60" vertex="1" connectable="0">
          <mxGeometry x="0.3412" y="-3" relative="1" as="geometry">
            <mxPoint x="-25" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-55" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; struct rtentry *rt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct iphdr *ihdr = ip_hdr(skb);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; rt = route_lookup(sk-&amp;gt;daddr);找到路由设备&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!rt) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // TODO: dest_unreachable&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; print_err(&quot;IP output route lookup fail\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return -1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;dev = rt-&amp;gt;dev;&lt;font color=&quot;#ff00ff&quot;&gt;找到某个网段的网卡设备 struct netdev&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;rt = rt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb_push(skb, IP_HDR_LEN);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;version = IPV4;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;ihl = 0x05;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;tos = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;len = skb-&amp;gt;len;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;id = ihdr-&amp;gt;id;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;frag_offset = 0x4000;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;ttl = 64;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;proto = skb-&amp;gt;protocol;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;saddr = skb-&amp;gt;dev-&amp;gt;addr;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;daddr = sk-&amp;gt;daddr;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;csum = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ip_dbg(&quot;out&quot;, ihdr);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;len = htons(ihdr-&amp;gt;len);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;id = htons(ihdr-&amp;gt;id);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;daddr = htonl(ihdr-&amp;gt;daddr);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;saddr = htonl(ihdr-&amp;gt;saddr);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;csum = htons(ihdr-&amp;gt;csum);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ihdr-&amp;gt;frag_offset = htons(ihdr-&amp;gt;frag_offset);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ip_send_check(ihdr);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return dst_neigh_output(skb);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="6840" y="3220" width="340" height="590" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-64" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yaBAwWdUjn6GlstP9hA2-59" target="yaBAwWdUjn6GlstP9hA2-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-65" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;netdev_transmit&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-64" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="-2" relative="1" as="geometry">
            <mxPoint x="16.17" y="-2.08" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-59" target="yaBAwWdUjn6GlstP9hA2-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-68" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;arp_get_hwaddr&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-67" vertex="1" connectable="0">
          <mxGeometry x="0.2742" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-70" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-59" target="yaBAwWdUjn6GlstP9hA2-69" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-71" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;arp_request&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="yaBAwWdUjn6GlstP9hA2-70" vertex="1" connectable="0">
          <mxGeometry x="-0.2617" y="3" relative="1" as="geometry">
            <mxPoint x="-3" y="12.25" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-59" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; struct iphdr *iphdr = ip_hdr(skb);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct netdev *netdev = skb-&amp;gt;dev;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct rtentry *rt = skb-&amp;gt;rt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; uint32_t daddr = ntohl(iphdr-&amp;gt;daddr);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; uint32_t saddr = ntohl(iphdr-&amp;gt;saddr);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; uint8_t *dmac;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (rt-&amp;gt;flags &amp;amp; RT_GATEWAY) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; daddr = rt-&amp;gt;gateway;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; dmac = arp_get_hwaddr(daddr); 通过IP地址，找到MAC地址&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (dmac) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return netdev_transmit(skb, dmac, ETH_P_IP);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; arp_request(saddr, daddr, netdev);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* Inform upper layer that traffic was not sent, retry later */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return -1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="7333" y="3346.25" width="350" height="337.5" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-63" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; struct netdev *dev;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct eth_hdr *hdr;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int ret = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; dev = skb-&amp;gt;dev;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb_push(skb, ETH_HDR_LEN);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; hdr = (struct eth_hdr *)skb-&amp;gt;data;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memcpy(hdr-&amp;gt;dmac, dst_hw, dev-&amp;gt;addr_len);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memcpy(hdr-&amp;gt;smac, dev-&amp;gt;hwaddr, dev-&amp;gt;addr_len);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; hdr-&amp;gt;ethertype = htons(ethertype);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; eth_dbg(&quot;out&quot;, hdr);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ret = tun_write((char *)skb-&amp;gt;data, skb-&amp;gt;len);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="7860" y="3388" width="300" height="254" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-66" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; struct list_head *item;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct arp_cache_entry *entry;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; list_for_each(item, &amp;amp;arp_cache) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; entry = list_entry(item, struct arp_cache_entry, list);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (entry-&amp;gt;state == ARP_RESOLVED &amp;amp;&amp;amp;&amp;nbsp;&lt;span&gt;entry-&amp;gt;sip == sip) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; arpcache_dbg(&quot;entry&quot;, entry);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; uint8_t *copy = entry-&amp;gt;smac;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return copy;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="7320.25" y="3025" width="375.5" height="200" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-72" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="yaBAwWdUjn6GlstP9hA2-69" target="yaBAwWdUjn6GlstP9hA2-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yaBAwWdUjn6GlstP9hA2-69" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; struct sk_buff *skb;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct arp_hdr *arp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct arp_ipv4 *payload;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int rc = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb = arp_alloc_skb();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!skb) return -1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;dev = netdev;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; payload = (struct arp_ipv4 *) skb_push(skb, ARP_DATA_LEN);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memcpy(payload-&amp;gt;smac, netdev-&amp;gt;hwaddr, netdev-&amp;gt;addr_len);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; payload-&amp;gt;sip = sip;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memcpy(payload-&amp;gt;dmac, broadcast_hw, netdev-&amp;gt;addr_len);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; payload-&amp;gt;dip = dip;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arp = (struct arp_hdr *) skb_push(skb, ARP_HDR_LEN);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arp_dbg(&quot;req&quot;, arp);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arp-&amp;gt;opcode = htons(ARP_REQUEST);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arp-&amp;gt;hwtype = htons(ARP_ETHERNET);&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arp-&amp;gt;protype = htons(ETH_P_IP);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arp-&amp;gt;hwsize = netdev-&amp;gt;addr_len;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arp-&amp;gt;prosize = 4;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata_dbg(&quot;req&quot;, payload);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; payload-&amp;gt;sip = htonl(payload-&amp;gt;sip);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; payload-&amp;gt;dip = htonl(payload-&amp;gt;dip);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; rc = netdev_transmit(skb, broadcast_hw, ETH_P_ARP);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; free_skb(skb);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="7320.25" y="3970" width="377" height="510" as="geometry" />
        </mxCell>
        <mxCell id="SpSznTODdMoxs4yrN4X4-1" value="&lt;div&gt;enum tcp_states {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; TCP_LISTEN,&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;/* represents waiting for a connection request from any remote TCP and port. */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; TCP_SYN_SENT,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* represents waiting for a matching connection request after having sent a connection request. */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; TCP_SYN_RECEIVED,&lt;span&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;/* represents waiting for a confirming connection request acknowledgment after having both received and sent a connection request. */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; TCP_ESTABLISHED,&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;/* represents an open connection, data received can be delivered to the user.&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; The normal state for the data transfer phase of the connection. 以上是三次握手过程 */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; TCP_FIN_WAIT_1,&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;/* represents waiting for a connection termination request from the remote TCP,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; or an acknowledgment of the connection termination request previously sent. */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; TCP_FIN_WAIT_2,&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;/* represents waiting for a connection termination request from the remote TCP. */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; TCP_CLOSE,&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;/* represents no connection state at all. */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; TCP_CLOSE_WAIT,&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;/* represents waiting for a connection termination request from the local user. */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; TCP_CLOSING,&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;/* represents waiting for a connection termination request acknowledgment from the remote TCP. */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; TCP_LAST_ACK,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span&gt;  &lt;/span&gt;/* represents waiting for an acknowledgment of the connection termination request previously sent to the remote TCP&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (which includes an acknowledgment of its connection termination request). */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; TCP_TIME_WAIT,&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;/* represents waiting for enough time to pass to be sure the remote TCP received the acknowledgment of its connection termination request. */&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="3020" y="1940" width="910" height="290" as="geometry" />
        </mxCell>
        <mxCell id="dzpFjZSb-bzoJs8NH7mf-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="dzpFjZSb-bzoJs8NH7mf-3" target="dzpFjZSb-bzoJs8NH7mf-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dzpFjZSb-bzoJs8NH7mf-2" value="&lt;span style=&quot;color: rgb(0 , 0 , 0) ; font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;transmit_lvlip&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=20;fontColor=#FF00FF;" parent="dzpFjZSb-bzoJs8NH7mf-1" vertex="1" connectable="0">
          <mxGeometry x="0.2879" y="2" relative="1" as="geometry">
            <mxPoint x="-20.83" y="-2.84" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dzpFjZSb-bzoJs8NH7mf-3" value="&lt;div&gt;int connect(int sockfd, const struct sockaddr *addr, socklen_t addrlen)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct lvlip_sock *sock = lvlip_get_sock(sockfd);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (sock == NULL) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 如果没有查找到我们协议栈的socket，&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 直接调用libc里的connect函数&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return _connect(sockfd, addr, addrlen);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int msglen = sizeof(struct ipc_msg) + sizeof(struct ipc_connect);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int pid = getpid();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct ipc_msg *msg = alloca(msglen);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; msg-&amp;gt;type = &lt;font color=&quot;#009900&quot;&gt;IPC_CONNECT&lt;/font&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; msg-&amp;gt;pid = pid;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct ipc_connect payload = {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .sockfd = sockfd,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .addr = *addr,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .addrlen = addrlen&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; };&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memcpy(msg-&amp;gt;data, &amp;amp;payload, sizeof(struct ipc_connect));&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return transmit_lvlip(sock-&amp;gt;lvlfd, msg, msglen);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;strokeColor=#FF00FF;" parent="1" vertex="1">
          <mxGeometry x="980" y="2756.25" width="400" height="422.5" as="geometry" />
        </mxCell>
        <mxCell id="dzpFjZSb-bzoJs8NH7mf-4" value="&lt;div&gt;_write(lvlfd, (char *)msg, msglen)&lt;/div&gt;&lt;div&gt;&lt;span&gt;_read(lvlfd, buf, RCBUF_LEN)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;// 发送的格式、回应的格式，都是自己定义的，哈哈哈！&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;// ipc_msg + ipc_err&lt;/div&gt;&lt;div&gt;struct ipc_msg *response = (struct ipc_msg *) buf;&lt;/div&gt;&lt;div&gt;&lt;span&gt;struct ipc_err *err = (struct ipc_err *) response-&amp;gt;data;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;font color=&quot;#ff00ff&quot;&gt;返回的是connect的返回值！&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;return err-&amp;gt;rc;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;strokeColor=#FF00FF;" parent="1" vertex="1">
          <mxGeometry x="1490" y="2880" width="350" height="175" as="geometry" />
        </mxCell>
        <mxCell id="dzpFjZSb-bzoJs8NH7mf-5" value="&lt;span style=&quot;text-align: left; font-size: 20px;&quot;&gt;liblevelip.so&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF00FF;" parent="1" vertex="1">
          <mxGeometry x="1407" y="2762.66" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=20;" parent="1" source="OfL4en9KDuTbf07v0vyc-1" target="OfL4en9KDuTbf07v0vyc-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-5" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;netdev_receive(skb);&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=20;" parent="OfL4en9KDuTbf07v0vyc-4" vertex="1" connectable="0">
          <mxGeometry x="0.284" relative="1" as="geometry">
            <mxPoint x="-31.67" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-1" value="&lt;div&gt;void *netdev_rx_loop()&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; while (running) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; struct sk_buff *skb = alloc_skb(BUFLEN);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (tun_read((char *)skb-&amp;gt;data, BUFLEN) &amp;lt; 0) {&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; perror(&quot;ERR: Read from tun_fd&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; free_skb(skb);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return NULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; netdev_receive(skb);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return NULL;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="100" y="139" width="350" height="241" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-2" value="接收线程" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;" parent="1" vertex="1">
          <mxGeometry x="200" y="55" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="OfL4en9KDuTbf07v0vyc-3" target="OfL4en9KDuTbf07v0vyc-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1080" y="259" />
              <mxPoint x="1080" y="-530" />
              <mxPoint x="1360" y="-530" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-8" value="&lt;span style=&quot;text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;arp_rcv(skb);&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;" parent="OfL4en9KDuTbf07v0vyc-7" vertex="1" connectable="0">
          <mxGeometry x="0.5487" y="-4" relative="1" as="geometry">
            <mxPoint x="88.67" y="-3.5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="1BnrM37lM0DcALCTK2Up-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="OfL4en9KDuTbf07v0vyc-3" target="1BnrM37lM0DcALCTK2Up-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1080" y="260" />
              <mxPoint x="1080" y="760" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="1BnrM37lM0DcALCTK2Up-4" value="&lt;span style=&quot;font-size: 12px ; text-align: left ; background-color: rgb(248 , 249 , 250)&quot;&gt;ip_rcv(skb);&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="1BnrM37lM0DcALCTK2Up-3">
          <mxGeometry x="0.6705" y="-2" relative="1" as="geometry">
            <mxPoint x="6.5" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-3" value="&lt;div style=&quot;font-size: 12px&quot;&gt;static int netdev_receive(struct sk_buff *skb)&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;{&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; struct eth_hdr *hdr = eth_hdr(skb);&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&lt;br style=&quot;font-size: 12px&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; eth_dbg(&quot;in&quot;, hdr);&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&lt;br style=&quot;font-size: 12px&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; switch (hdr-&amp;gt;ethertype) {&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case ETH_P_ARP:&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;arp_rcv(skb);&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case ETH_P_IP:&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;ip_rcv(skb);&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case ETH_P_IPV6:&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; default:&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; printf(&quot;Unsupported ethertype %x\n&quot;, hdr-&amp;gt;ethertype);&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; free_skb(skb);&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&lt;br style=&quot;font-size: 12px&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&amp;nbsp; &amp;nbsp; return 0;&lt;/div&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;}&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="1" vertex="1">
          <mxGeometry x="639" y="99" width="351" height="321" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fontSize=12;" parent="1" source="OfL4en9KDuTbf07v0vyc-6" target="OfL4en9KDuTbf07v0vyc-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;" parent="1" source="OfL4en9KDuTbf07v0vyc-6" target="OfL4en9KDuTbf07v0vyc-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;" parent="1" source="OfL4en9KDuTbf07v0vyc-6" target="OfL4en9KDuTbf07v0vyc-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-6" value="&lt;div&gt;void arp_rcv(struct sk_buff *skb)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct arp_hdr *arphdr;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct arp_ipv4 *arpdata;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct netdev *netdev;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int merge = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; //以太头之后的，就是ARP数据了&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arphdr = arp_hdr(skb);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arphdr-&amp;gt;hwtype = ntohs(arphdr-&amp;gt;hwtype);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arphdr-&amp;gt;protype = ntohs(arphdr-&amp;gt;protype);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arphdr-&amp;gt;opcode = ntohs(arphdr-&amp;gt;opcode);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arp_dbg(&quot;in&quot;, arphdr);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (arphdr-&amp;gt;hwtype != ARP_ETHERNET) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; printf(&quot;ARP: Unsupported HW type\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (arphdr-&amp;gt;protype != ARP_IPV4) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; printf(&quot;ARP: Unsupported protocol\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata = (struct arp_ipv4 *) arphdr-&amp;gt;data;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata-&amp;gt;sip = ntohl(arpdata-&amp;gt;sip);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata-&amp;gt;dip = ntohl(arpdata-&amp;gt;dip);//接收方IP&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata_dbg(&quot;receive&quot;, arpdata);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; merge = &lt;font color=&quot;#ff0000&quot;&gt;update_arp_translation_table&lt;/font&gt;(arphdr, arpdata);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; //根据接收方IP找到 netdev 设备&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!(netdev = &lt;font color=&quot;#ff00ff&quot;&gt;netdev_get&lt;/font&gt;(arpdata-&amp;gt;dip))) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; printf(&quot;ARP was not for us\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!merge &amp;amp;&amp;amp; &lt;font color=&quot;#ff0000&quot;&gt;insert_arp_translation_table&lt;/font&gt;(arphdr, arpdata) != 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; print_err(&quot;ERR: No free space in ARP translation table\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; switch (arphdr-&amp;gt;opcode) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case ARP_REQUEST:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;arp_reply(skb, netdev);&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; default:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; printf(&quot;ARP: Opcode not supported\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;drop_pkt:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; free_skb(skb);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="1" vertex="1">
          <mxGeometry x="1390" y="-940" width="370" height="821" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-9" value="&lt;div&gt;static int &lt;font color=&quot;#ff0000&quot;&gt;insert_&lt;/font&gt;arp_translation_table(struct arp_hdr *hdr, struct arp_ipv4 *data)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct arp_cache_entry *entry = arp_entry_alloc(hdr, data);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pthread_mutex_lock(&amp;amp;lock);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; list_add_tail(&amp;amp;entry-&amp;gt;list, &amp;amp;arp_cache);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pthread_mutex_unlock(&amp;amp;lock);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return 0;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;static int &lt;font color=&quot;#ff0000&quot;&gt;update_&lt;/font&gt;arp_translation_table(struct arp_hdr *hdr, struct arp_ipv4 *data)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct list_head *item;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct arp_cache_entry *entry;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pthread_mutex_lock(&amp;amp;lock);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; list_for_each(item, &amp;amp;arp_cache) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; entry = list_entry(item, struct arp_cache_entry, list);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (entry-&amp;gt;hwtype == hdr-&amp;gt;hwtype &amp;amp;&amp;amp; entry-&amp;gt;sip == data-&amp;gt;sip) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; memcpy(entry-&amp;gt;smac, data-&amp;gt;smac, 6);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pthread_mutex_unlock(&amp;amp;lock);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return 1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pthread_mutex_unlock(&amp;amp;lock);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return 0;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="1" vertex="1">
          <mxGeometry x="1880" y="-1160" width="440" height="470" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-10" value="&lt;div&gt;&lt;font color=&quot;#ff33ff&quot;&gt;struct netdev* netdev_get(uint32_t sip)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; netdev是本协议栈刚开始时，&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; 初始化的一个虚拟的网卡，IP地址是10.0.0.5&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (&lt;b&gt;netdev-&amp;gt;addr&lt;/b&gt; == sip) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return netdev;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return NULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="1" vertex="1">
          <mxGeometry x="1880" y="-665" width="280" height="160" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;" parent="1" source="OfL4en9KDuTbf07v0vyc-11" target="OfL4en9KDuTbf07v0vyc-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-11" value="&lt;div&gt;void arp_reply(struct sk_buff *skb, struct netdev *netdev)&amp;nbsp;&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct arp_hdr *arphdr;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct arp_ipv4 *arpdata;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; //取出以太头之后的数据，就是ARP数据了&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arphdr = arp_hdr(skb);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; //skb-&amp;gt;data指针，往前加，一下保留3段&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb_reserve(skb, ETH_HDR_LEN + ARP_HDR_LEN + ARP_DATA_LEN);&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; //要修改那一段的内容时，把那一段push出来。&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; //skb-&amp;gt;data指针，往后缩&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb_push(skb, ARP_HDR_LEN + ARP_DATA_LEN);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; //直接在原skb的基础上，修改字段，拼凑出要发出的skb&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata = (struct arp_ipv4 *) arphdr-&amp;gt;data;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memcpy(arpdata-&amp;gt;dmac, arpdata-&amp;gt;smac, 6);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata-&amp;gt;dip = arpdata-&amp;gt;sip;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memcpy(arpdata-&amp;gt;smac, netdev-&amp;gt;hwaddr, 6);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata-&amp;gt;sip = netdev-&amp;gt;addr;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arphdr-&amp;gt;opcode = ARP_REPLY;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arp_dbg(&quot;reply&quot;, arphdr);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arphdr-&amp;gt;opcode = htons(arphdr-&amp;gt;opcode);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arphdr-&amp;gt;hwtype = htons(arphdr-&amp;gt;hwtype);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arphdr-&amp;gt;protype = htons(arphdr-&amp;gt;protype);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata_dbg(&quot;reply&quot;, arpdata);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata-&amp;gt;sip = htonl(arpdata-&amp;gt;sip);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; arpdata-&amp;gt;dip = htonl(arpdata-&amp;gt;dip);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;dev = netdev;//指定发出时，使用的网卡是哪个&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff00ff&quot;&gt;netdev_transmit(skb, arpdata-&amp;gt;dmac, ETH_P_ARP);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; free_skb(skb);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="1" vertex="1">
          <mxGeometry x="1880" y="-480" width="440" height="560" as="geometry" />
        </mxCell>
        <mxCell id="OfL4en9KDuTbf07v0vyc-15" value="&lt;div&gt;&lt;font color=&quot;#ff00ff&quot;&gt;int netdev_transmit(struct sk_buff *skb, uint8_t *dst_hw, uint16_t ethertype)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct netdev *dev;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct eth_hdr *hdr;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int ret = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; dev = skb-&amp;gt;dev;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; //skb-&amp;gt;data 指针，往后缩一个以太头的长度&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb_push(skb, ETH_HDR_LEN);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; hdr = (struct eth_hdr *)skb-&amp;gt;data;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memcpy(hdr-&amp;gt;dmac, dst_hw, dev-&amp;gt;addr_len);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memcpy(hdr-&amp;gt;smac, dev-&amp;gt;hwaddr, dev-&amp;gt;addr_len);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; hdr-&amp;gt;ethertype = htons(ethertype);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; eth_dbg(&quot;out&quot;, hdr);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ret = tun_write((char *)skb-&amp;gt;data, skb-&amp;gt;len);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return ret;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="1" vertex="1">
          <mxGeometry x="2481" y="-360" width="409" height="320" as="geometry" />
        </mxCell>
        <mxCell id="gIYduDAJmmqJuRQVjXG6-2" value="以太头：&lt;br&gt;&lt;div&gt;dst mac表示的是对端的mac地址，&lt;/div&gt;&lt;div&gt;src mac表示的是自己的 mac 地址。&lt;/div&gt;&lt;div&gt;type字段用来表示帧中数据的协议类型。&lt;/div&gt;&lt;div&gt;&lt;span&gt;比较常用的类型有0x0806，表示这是一个ARP请求或者应答帧。&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;br&gt;ARP数据：&lt;br&gt;&lt;div&gt;hwtp表示硬件的类型，指的是硬件地址的类型，我们这里一般令其为1，也就是以太网地址（MAC地址）。&lt;/div&gt;&lt;div&gt;prot表示协议类型，这个字段其实和以太网头部的type字段是一致的，当然，这是有意设计的。&lt;/div&gt;&lt;div&gt;hwsz表示表示硬件地址的长度，对于以太帧来说，这个值通常设定为6，即48位。&lt;/div&gt;&lt;div&gt;prosz表示协议地址的长度，ARP请求或者应答的数据包，这个值通常被设定为4，即48位，恰好是IP地址的长度。&lt;/div&gt;&lt;div&gt;src mac, src ip表示的是源mac地址，源ip地址，&lt;/div&gt;&lt;div&gt;dst mac， dst ip表示的是目的mac，目的ip地址。&lt;/div&gt;&lt;div&gt;&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="2590" y="-1100" width="610" height="490" as="geometry" />
        </mxCell>
        <mxCell id="gIYduDAJmmqJuRQVjXG6-3" value="IP头：&lt;br&gt;&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;div&gt;Version占4位，指IP协议的版本，通信双方使用的IP协议的版本必须一致。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;IHL占4位，用于表示IP首部的长度，单位是4字节，因为只有4bit，&lt;/div&gt;&lt;div&gt;所以这个字段的最大值是15，即IP首部最多只能有15 * 4 = 60字节。&lt;/div&gt;&lt;div&gt;但是最小值是5，因为IP分组的首部长度最小为5 * 4 = 20个字节。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Type of Service，占8位，区分服务，一般情况下不使用这个字段。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Total Length，占16位，表示整个IP数据包，包括IP首部和IP数据之和的长度，单位为字节。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Identification，占16位，表示标识，用于标记这个IP数据报。&lt;/div&gt;&lt;div&gt;但这个标识并不是序号，因为IP是无连接服务，数据报不存在按序接收的问题，&lt;/div&gt;&lt;div&gt;当数据报由于长度超过网络的MTU而必须分片时，&lt;/div&gt;&lt;div&gt;这个标识字段就会被复制到所有的数据报片的标识字段中，&lt;/div&gt;&lt;div&gt;相同的标识字段的值，使分片后的各个数据报片最后能够重装成原来的数据报。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;flags，占3位，目前仅有两位有意义。&lt;/div&gt;&lt;div&gt;标志位中最低位记为MF(More Fragment)。MF=1表示后面还有分片。MF=0表示这已经是若干数据报片中的最后一个。&lt;/div&gt;&lt;div&gt;标志字段中间的一位记为DF(Don&#39;t Fragment)，意思是不能分片，只有当DF=0才允许分片。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Fragment offset,占13位，表示片偏移，片偏移意为，某片在原分组中的相对位置。片偏移以8个字节为偏移单位，即每个分片长度一定是8个字节的整数倍。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Time to Live,占8位，生存时间。&lt;/div&gt;&lt;div&gt;数据包每经过一个路由器，就将该字段的值减1，如果该字段减为0还没有到达目的地址，那么路由器会将这个数据包丢弃。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Protocol，占8位，协议字段指出该数据报携带的数据是使用何种协议（ICMP、TCP或UDP）&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Header Checksum，占16位，头部的检验和。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;后面的Options其实是可选项，可有可无。&lt;/div&gt;&lt;div&gt;Padding表示填充，使得头部大小是4字节的倍数。&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="3200" y="-1100" width="830" height="840" as="geometry" />
        </mxCell>
        <mxCell id="1BnrM37lM0DcALCTK2Up-1" value="ICMP的数据，在IP头的基础之上。&lt;br&gt;&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;&quot;&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="4030" y="-1100" width="440" height="300" as="geometry" />
        </mxCell>
        <mxCell id="1BnrM37lM0DcALCTK2Up-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="1BnrM37lM0DcALCTK2Up-2" target="1BnrM37lM0DcALCTK2Up-5">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1780" y="760" />
              <mxPoint x="1780" y="480" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="1BnrM37lM0DcALCTK2Up-2" value="&lt;div&gt;int ip_rcv(struct sk_buff *skb)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct iphdr *ih = ip_hdr(skb);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; uint16_t csum = -1;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (ih-&amp;gt;version != IPV4) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; print_err(&quot;Datagram version was not IPv4\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (ih-&amp;gt;ihl &amp;lt; 5) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; print_err(&quot;IPv4 header length must be at least 5\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (ih-&amp;gt;ttl == 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //TODO: Send ICMP error&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; print_err(&quot;Time to live of datagram reached 0\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; csum = checksum(ih, ih-&amp;gt;ihl * 4, 0);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (csum != 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // Invalid checksum, drop packet handling&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; // TODO: Check fragmentation, possibly reassemble&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ip_init_pkt(ih);//字节序变换&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ip_dbg(&quot;in&quot;, ih);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; switch (ih-&amp;gt;proto) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case ICMPV4:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;icmpv4_incoming(skb);&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case IP_TCP:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;tcp_in(skb);&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; default:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; print_err(&quot;Unknown IP header proto\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;drop_pkt:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; free_skb(skb);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return 0;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1320" y="400" width="370" height="720" as="geometry" />
        </mxCell>
        <mxCell id="1BnrM37lM0DcALCTK2Up-5" value="&lt;div&gt;void icmpv4_incoming(struct sk_buff *skb)&amp;nbsp;&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct iphdr *iphdr = ip_hdr(skb);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct icmp_v4 *icmp = (struct icmp_v4 *) iphdr-&amp;gt;data;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; //TODO: Check csum&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; switch (icmp-&amp;gt;type) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case &lt;b&gt;ICMP_V4_ECHO&lt;/b&gt;:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;icmpv4_reply(skb);&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case ICMP_V4_DST_UNREACHABLE:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; print_err(&quot;ICMPv4 received &#39;dst unreachable&#39; code %d, &quot;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &quot;check your routes and firewall rules\n&quot;, icmp-&amp;gt;code);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; default:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; print_err(&quot;ICMPv4 did not match supported types\n&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; goto drop_pkt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;drop_pkt:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; free_skb(skb);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;void icmpv4_reply(struct sk_buff *skb)&lt;/b&gt;&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct iphdr *iphdr = ip_hdr(skb);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct icmp_v4 *icmp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct sock sk;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memset(&amp;amp;sk, 0, sizeof(struct sock));&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; uint16_t icmp_len = iphdr-&amp;gt;len - (iphdr-&amp;gt;ihl * 4);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; 直接在原来的skb基础之上修改，拼凑要发送出去的skb&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb_reserve(skb, ETH_HDR_LEN + IP_HDR_LEN + icmp_len);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb_push(skb, icmp_len);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; icmp = (struct icmp_v4 *)skb-&amp;gt;data;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; icmp-&amp;gt;type = &lt;b&gt;ICMP_V4_REPLY&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; icmp-&amp;gt;csum = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; icmp-&amp;gt;csum = checksum(icmp, icmp_len, 0);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; skb-&amp;gt;protocol = ICMPV4;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; sk.daddr = iphdr-&amp;gt;saddr;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;ip_output(&amp;amp;sk, skb);下边有列出，此处略。&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; free_skb(skb);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1880" y="120" width="590" height="720" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
